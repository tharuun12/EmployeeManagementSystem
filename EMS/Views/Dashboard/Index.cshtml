@{
    ViewData["Title"] = "EMS Dashboard";
    var recentEmployees = ViewBag.RecentEmployees as List<EMS.Models.Employee>;
    var departmentStats = ViewBag.DepartmentStats as List<dynamic>;
}
@using EMS.ViewModels;
@model List<DepartmentStatsViewModel>


<h2 class="text-center mb-4">EMS Dashboard</h2>

<div class="dashboard-cards">
    <div class="card total">
        <h3>Total Employees</h3>
        <p>@ViewBag.TotalEmployees</p>
    </div>
    <div class="card active">
        <h3>Active Employees</h3>
        <p>@ViewBag.ActiveEmployees</p>
    </div>
    <div class="card departments">
        <h3>Total Departments</h3>
        <p>@ViewBag.TotalDepartments</p>
    </div>
</div>

<!-- Existing Summary Chart -->

@* <!-- Pie Chart for Active Employees by Department -->
<h4 class="mt-5">📊 Active Employees by Department</h4>
<canvas id="activeEmployeesChart" height="100" class="mb-5"></canvas>

<!-- Doughnut Chart for Department vs Employee -->
<h4 class="mt-5">🏢 Department vs Employee Distribution</h4>
<canvas id="departmentDistributionChart" height="100"></canvas> *@
<div style="display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
    <div>
        <p>Employee's Department Wise</p>
        <canvas id="activeEmployeesChart" width="400" height="400" class="chart-canvas"></canvas>
    </div>
    <div>
        <p></p>
        <canvas id="summaryChart" width="400" height="400" class="chart-canvas"></canvas>

        @* <canvas id="departmentDistributionChart" width="400" height="400" class="chart-canvas"></canvas> *@
    </div>
</div>


<h4 class="mt-5">🧑‍💼 Recent Employees</h4>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Designation</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var emp in recentEmployees)
        {
            <tr>
                <td>@emp.FullName</td>
                <td>@emp.Email</td>
                <td>@emp.PhoneNumber</td>
                <td>@emp.Role</td>
                @* <td>@emp.CreatedDate.ToString("dd MMM yyyy")</td> *@
            </tr>
        }
    </tbody>
</table>

<h4 class="mt-5">🏢 Department-wise Employee Count</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Department</th>
            <th>No. of Employees</th>
        </tr>
    </thead>
    @* Have to solve this issue of returning the null value even there is a persent of data  *@
    <tbody>
        @foreach (var stat in Model)
        {
            <tr>
                <td>@stat.Name</td>
                <td>@stat.EmployeeCount</td>
            </tr>
        }
    </tbody>


</table>
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Summary Bar Chart
        const ctx = document.getElementById('summaryChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Total Employees', 'Active Employees', 'Departments'],
                datasets: [{
                    label: 'EMS Overview',
                    data: [@ViewBag.TotalEmployees, @ViewBag.ActiveEmployees, @ViewBag.TotalDepartments],
                    backgroundColor: ['#3498db', '#2ecc71', '#9b59b6'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Pie Chart
        const activeLabels = @Html.Raw(Json.Serialize(Model.Select(d => d.Name)));
        const activeData = @Html.Raw(Json.Serialize(Model.Select(d => d.EmployeeCount)));

        const ctxPie = document.getElementById('activeEmployeesChart').getContext('2d');
        new Chart(ctxPie, {
            type: 'pie',
            data: {
                labels: activeLabels,
                datasets: [{
                    label: 'Active Employees',
                    data: activeData,
                    backgroundColor: [
                        '#4e79a7', // Cool Blue
                        '#f28e2c', // Orange
                        '#e15759', // Soft Red
                        '#76b7b2', // Teal
                        '#59a14f', // Green
                        '#edc948', // Mustard Yellow
                        '#b07aa1', // Purple
                        '#9c755f'  // Brownish
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });

        // Doughnut Chart
        const ctxDonut = document.getElementById('departmentDistributionChart').getContext('2d');
        new Chart(ctxDonut, {
            type: 'doughnut',
            data: {
                labels: ['Total Departments', 'Total Employees'],
                datasets: [{
                    label: 'Distribution',
                    data: [@ViewBag.TotalDepartments, @ViewBag.TotalEmployees],
                    backgroundColor: ['#1f77b4', '#17becf'],

                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    </script>
}

